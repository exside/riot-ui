var rui={utils:{keycode:{ENTER:13,ARROW_DOWN:40,ARROW_UP:38,ARROW_LEFT:37,ARROW_RIGHT:39,BACKSPACE:8,ESC:27,DELETE:46}}};riot.tag2("autocomplete",'<input type="text" name="_input" class="input" onkeydown="{handleArrowKeys}" onkeyup="{filterOptions}" onfocus="{showOptions}" onblur="{hideOptions}" placeholder="{opts.placeholder}"> <ul class="menu" name="_optionList" if="{shouldShowOptions && filteredCount()}"> <li class="menu-block {active: index == active}" each="{option, index in filtered}" onmouseover="{hoverOption}" onmousedown="{chooseCurrent}">{option.text} </li> </ul>','autocomplete,[riot-tag="autocomplete"] { display: block; position: relative; } autocomplete .menu,[riot-tag="autocomplete"] .menu { position: absolute; left: 0; top: calc(100% + 5px); margin: 0; padding: 0; background-color: white; max-height: 200px; width: 100%; overflow-y: hidden; z-index: 99; border-color: #08e; } autocomplete .menu-block:hover,[riot-tag="autocomplete"] .menu-block:hover { background-color: transparent; } autocomplete .menu-block.active,[riot-tag="autocomplete"] .menu-block.active { background-color: #ddd !important; } autocomplete .input,[riot-tag="autocomplete"] .input { width: 100%; }','class="{focus: document.hasFocus() && _input === document.activeElement}"',function(t){"use strict";var e=this,o=rui.utils.keycode;this.active=0,this.filtered=this.opts.options.filter(function(t){return!e.opts.filter||e.opts.filter(t)}),this.filteredCount=function(){return e.filtered.length},this.hoverOption=function(t){!e.hoverLocked&&(e.active=t.item.index)},this.reset=function(){e._input.value="",e.selected=null,e.filterOptions(),e.hideOptions()},this.hideOptions=function(){e.shouldShowOptions=!1},this.showOptions=function(){e.shouldShowOptions||(e.active=0),e.shouldShowOptions=!0},this.filterOptions=function(t){var i=t?t.keyCode:-1;switch(i){case o.ARROW_LEFT:case o.ARROW_RIGHT:return!0;case o.ESC:case o.ENTER:return e.hideOptions(),!0;case o.ARROW_DOWN:case o.ARROW_UP:return e.showOptions(),!0}var n=new RegExp("(^|\\s)"+e._input.value.trim(),"i");return e.filtered=e.opts.options.filter(function(t){return n.test(t.text)&&(!e.opts.filter||e.opts.filter(t))}),e.active=0,e.showOptions(),!0},this.chooseCurrent=function(){var t=e.filtered[e.active];e._input.value=t.text,e.opts.onchange&&e.selected!=t&&e.opts.onchange(t),e.selected=t,e.hideOptions(),e.update()},this.handleArrowKeys=function(t){switch(t.keyCode){case o.ARROW_DOWN:return e.lockHover(),t.preventDefault(),e.active=Math.min(e.active+1,e.filteredCount()-1),!1;case o.ARROW_UP:return e.lockHover(),t.preventDefault(),e.active=Math.max(0,e.active-1),!1;case o.ENTER:return e.chooseCurrent(),!0}return!0},this.lockHover=function(){var t=this,e=function o(){t.hoverLocked=!1,window.removeEventListener("mousemove",o)};window.addEventListener("mousemove",e),this.hoverLocked=!0},this.on("updated",function(){var t=e._optionList.querySelector(".active");if(t){var o=e._optionList.offsetHeight,i=e._optionList.scrollTop,n=t.offsetTop,s=t.offsetHeight;n+s>i+o&&(e._optionList.scrollTop+=n+s-i-o),i>=n&&(e._optionList.scrollTop=n)}})},"{ }");